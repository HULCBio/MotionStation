<!--
This HTML is auto-generated from an m-file.
Your changes will be overwritten.
--><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:x-large">How to choose knots when you have to</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Illustration of the use of OPTKNT and NEWKNT.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"> Copyright 1987-2003 C. de Boor and The MathWorks, Inc.
  $Revision: 1.18 $
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium;">Overview</p><ul xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"><li><a href="#Sample function">Sample function</a></li><li><a href="#Sample data">Sample data</a></li><li><a href="#General considerations">General considerations</a></li><li><a href="#Optimal knots">Optimal knots</a></li><li><a href="#Trying OPTKNT">Trying OPTKNT</a></li><li><a href="#What happened?">What happened?</a></li><li><a href="#Knot choice for least squares approximation">Knot choice for least squares approximation</a></li><li><a href="#Least squares approximation with uniform knot sequence">Least squares approximation with uniform knot sequence</a></li><li><a href="#Using NEWKNT to improve the knot distribution for these data">Using NEWKNT to improve the knot distribution for these data</a></li></ul><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Sample function<a name="Sample function"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Here are some sample data, much used for testing spline approximation
with variable knots, the so-called Titanium Heat Data, which record some
property of titanium measured as a function of temperature. Notice the
rather sharp peak.
We'll use this function to illustrate some methods for knot selection.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">[xx,yy] = titanium;
frame = [-10 10 -.1 .1]+[min(xx),max(xx),min(yy),max(yy)];
plot(xx,yy,<span style="color:#B20000">'x'</span>), grid off, axis(frame)
title(<span style="color:#B20000">'The titanium heat data show a pronounced peak'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_02_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Sample data<a name="Sample data"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We pick a few data points from these somewhat rough data, since we
want to interpolate. The data points picked are marked in the graph.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pick = [1 5 11 21  27 29 31 33 35 40 45 49];
tau = xx(pick); y = yy(pick);
hold on
plot(tau,y,<span style="color:#B20000">'ro'</span>)
title(<span style="color:#B20000">'Titanium heat data with selected points marked'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_03_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">General considerations<a name="General considerations"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Since a spline of order  k  with  n+k  knots has  n  degrees of freedom, and
we have 12 data sites, tau(1)&lt; ... &lt; tau(12), a fit with a cubic spline,
i.e., a fourth order spline, requires a knot sequence  t  of length  12+4 .
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Moreover, the knot sequence  t  must satisfy the Schoenberg-Whitney
conditions, i.e., must be such that the i-th data site lies in the support
of the i-th B-spline, i.e.,
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">              t(i) &lt; tau(i) &lt; t(i+k) , all  i ,
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">(with equality allowed only in case of a knot of multiplicity  k ).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">One way to choose a knot sequence satisfying all these conditions is
as the optimal knots, of Gaffney/Powell and Micchelli/Rivlin/Winograd.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Optimal knots<a name="Optimal knots"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">In  o p t i m a l  spline interpolation, to values at sites
                        tau(1), ..., tau(n)
say, one chooses the knots so as to minimize the constant in a standard
error formula. Specifically, one chooses the first and the last data site
as a k-fold knot. The remaining  n-k  knots are supplied by OPTKNT.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Here is the beginning of the help from OPTKNT:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px"><span style="color:green">%OPTKNT Optimal knot distribution.</span>
<span style="color:green">%</span>
<span style="color:green">%   OPTKNT(TAU,K)  returns an `optimal' knot sequence for interpolation at</span>
<span style="color:green">%   data sites TAU(1), ..., TAU(n) by splines of order K. </span>
<span style="color:green">%   TAU must be an increasing sequence, but this is not checked.</span>
<span style="color:green">%</span>
<span style="color:green">%   OPTKNT(TAU,K,MAXITER) specifies the number MAXITER of iterations to be</span>
<span style="color:green">%   tried, the default being 10.</span>
<span style="color:green">%</span>
<span style="color:green">%   The interior knots of this knot sequence are the  n-K  sign-changes in</span>
<span style="color:green">%   any absolutely constant function  h ~= 0  that satisfies </span>
<span style="color:green">%</span>
<span style="color:green">%          integral{ f(x)h(x) : TAU(1) &lt; x &lt; TAU(n) } = 0</span>
<span style="color:green">%</span>
<span style="color:green">%   for all splines  f  of order K with knot sequence TAU.</span></pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Trying OPTKNT<a name="Trying OPTKNT"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We try this for interpolation on our example, in which we want to
interpolate by cubic splines to data  (tau(i),y(i)),  i=1,...,n :
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">k = 4; 
osp = spapi( optknt(tau,k), tau,y);

fnplt(osp,<span style="color:#B20000">'r'</span>), hold on, plot(tau,y,<span style="color:#B20000">'ro'</span>), grid off
title(<span style="color:#B20000">'Spline interpolant to the selected data using optimal knots'</span>)
xlabel(<span style="color:#B20000">'...  a bit disconcerting'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_06_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">This is a bit disconcerting!
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Here, marked by stars, are also the (interior) optimal knots:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">xi = fnbrk(osp,<span style="color:#B20000">'knots'</span>); xi([1:k end+1-(1:k)]) = [];
plot(xi,repmat((frame(3)+frame(4))/2, size(xi)),<span style="color:#B20000">'*'</span>)
xlabel(<span style="color:#B20000">'...  and the optimal knots (*)'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_07_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">What happened?<a name="What happened?"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The knot choice for optimal interpolation is designed to make the
maximum over  a l l  functions  f  of the ratio   norm{f - If}/norm{D^k f}
of the norm of the interpolation error  f - If  to the norm of the  k-th
derivative  D^k f  of the interpoland as small as  possible.  Since our data
imply that  D^k f  is rather large, the interpolation error near the flat
part of the data is of acceptable size for such an `optimal' scheme.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Actually, for these data, the ordinary cubic spline interpolant provided by
CSAPI does quite well:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">cs = csapi(tau,y); fnplt(cs,<span style="color:#B20000">'g'</span>,2)
xlabel(<span style="color:#B20000">'...  and the optimal knots (x), and the interpolant provided by CSAPI.'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_08_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Knot choice for least squares approximation<a name="Knot choice for least squares approximation"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Knots must be selected when doing least-squares approximation by splines.
One approach is to use equally spaced knots to begin with, then use NEWKNT
with the approximation obtained for a better knot distribution.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The next sections illustrate this with the full titanium heat data set.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Least squares approximation with uniform knot sequence<a name="Least squares approximation with uniform knot sequence"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We start with a uniform knot sequence.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">sp = spap2(augknt(linspace(xx(1), xx(end), 2+fix(length(xx)/4)),k),k, xx,yy);
fnplt(sp,<span style="color:#B20000">'r'</span>), hold on, plot(xx,yy,<span style="color:#B20000">'x'</span>), axis(frame)
title(<span style="color:#B20000">'Least-squares fit by cubic spline (red) with uniform knot sequence,'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_10_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">This is not at all satisfactory. So we use NEWKNT for a spline approximation
of the same order and with the same number of polynomial pieces, but better
distributed:
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Using NEWKNT to improve the knot distribution for these data<a name="Using NEWKNT to improve the knot distribution for these data"></a></p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">spgood = spap2( newknt(sp), k, xx,yy);
fnplt(spgood,<span style="color:#B20000">'g'</span>,1.5)
xlabel(<span style="color:#B20000">'... and (green) with a knot sequence chosen from it by NEWKNT.'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="pckkntdm_img_12_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">This is quite good. Incidentally, one less interior knot would not have
sufficed in this case.
</p><originalCode xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" code="%%     How to choose knots when you have to&#xA;%&#xA;% Illustration of the use of OPTKNT and NEWKNT.&#xA;%&#xA;%   Copyright 1987-2003 C. de Boor and The MathWorks, Inc.&#xA;%   $Revision: 1.18 $&#xA;&#xA;%% Sample function&#xA;% Here are some sample data, much used for testing spline approximation&#xA;% with variable knots, the so-called Titanium Heat Data, which record some&#xA;% property of titanium measured as a function of temperature. Notice the&#xA;% rather sharp peak.&#xA;% We'll use this function to illustrate some methods for knot selection.&#xA;&#xA;[xx,yy] = titanium;&#xA;frame = [-10 10 -.1 .1]+[min(xx),max(xx),min(yy),max(yy)];&#xA;plot(xx,yy,'x'), grid off, axis(frame)&#xA;title('The titanium heat data show a pronounced peak')&#xA;&#xA;%% Sample data&#xA;% We pick a few data points from these somewhat rough data, since we&#xA;% want to interpolate. The data points picked are marked in the graph.&#xA;&#xA;pick = [1 5 11 21  27 29 31 33 35 40 45 49];&#xA;tau = xx(pick); y = yy(pick);&#xA;hold on&#xA;plot(tau,y,'ro')&#xA;title('Titanium heat data with selected points marked')&#xA;&#xA;%% General considerations&#xA;% Since a spline of order  k  with  n+k  knots has  n  degrees of freedom, and&#xA;% we have 12 data sites, tau(1)< ... < tau(12), a fit with a cubic spline,&#xA;% i.e., a fourth order spline, requires a knot sequence  t  of length  12+4 .&#xA;%&#xA;% Moreover, the knot sequence  t  must satisfy the Schoenberg-Whitney&#xA;% conditions, i.e., must be such that the i-th data site lies in the support&#xA;% of the i-th B-spline, i.e.,&#xA;%&#xA;%                t(i) < tau(i) < t(i+k) , all  i ,&#xA;%&#xA;% (with equality allowed only in case of a knot of multiplicity  k ).&#xA;%&#xA;% One way to choose a knot sequence satisfying all these conditions is&#xA;% as the optimal knots, of Gaffney/Powell and Micchelli/Rivlin/Winograd.&#xA;&#xA;%% Optimal knots&#xA;% In  o p t i m a l  spline interpolation, to values at sites&#xA;%                         tau(1), ..., tau(n)&#xA;% say, one chooses the knots so as to minimize the constant in a standard&#xA;% error formula. Specifically, one chooses the first and the last data site&#xA;% as a k-fold knot. The remaining  n-k  knots are supplied by OPTKNT.&#xA;%&#xA;% Here is the beginning of the help from OPTKNT:&#xA;%OPTKNT Optimal knot distribution.&#xA;%&#xA;%   OPTKNT(TAU,K)  returns an `optimal' knot sequence for interpolation at&#xA;%   data sites TAU(1), ..., TAU(n) by splines of order K. &#xA;%   TAU must be an increasing sequence, but this is not checked.&#xA;%&#xA;%   OPTKNT(TAU,K,MAXITER) specifies the number MAXITER of iterations to be&#xA;%   tried, the default being 10.&#xA;%&#xA;%   The interior knots of this knot sequence are the  n-K  sign-changes in&#xA;%   any absolutely constant function  h ~= 0  that satisfies &#xA;%&#xA;%          integral{ f(x)h(x) : TAU(1) < x < TAU(n) } = 0&#xA;%&#xA;%   for all splines  f  of order K with knot sequence TAU.&#xA;&#xA;%% Trying OPTKNT&#xA;% We try this for interpolation on our example, in which we want to&#xA;% interpolate by cubic splines to data  (tau(i),y(i)),  i=1,...,n :&#xA;&#xA;k = 4; &#xA;osp = spapi( optknt(tau,k), tau,y);&#xA;&#xA;fnplt(osp,'r'), hold on, plot(tau,y,'ro'), grid off&#xA;title('Spline interpolant to the selected data using optimal knots')&#xA;xlabel('...  a bit disconcerting')&#xA;&#xA;%%&#xA;% This is a bit disconcerting!&#xA;%&#xA;% Here, marked by stars, are also the (interior) optimal knots:&#xA;xi = fnbrk(osp,'knots'); xi([1:k end+1-(1:k)]) = [];&#xA;plot(xi,repmat((frame(3)+frame(4))/2, size(xi)),'*')&#xA;xlabel('...  and the optimal knots (*)')&#xA;&#xA;%% What happened?&#xA;% The knot choice for optimal interpolation is designed to make the&#xA;% maximum over  a l l  functions  f  of the ratio   norm{f - If}/norm{D^k f}&#xA;% of the norm of the interpolation error  f - If  to the norm of the  k-th&#xA;% derivative  D^k f  of the interpoland as small as  possible.  Since our data&#xA;% imply that  D^k f  is rather large, the interpolation error near the flat&#xA;% part of the data is of acceptable size for such an `optimal' scheme.&#xA;%&#xA;% Actually, for these data, the ordinary cubic spline interpolant provided by&#xA;% CSAPI does quite well:&#xA;&#xA;cs = csapi(tau,y); fnplt(cs,'g',2)&#xA;xlabel('...  and the optimal knots (x), and the interpolant provided by CSAPI.')&#xA;hold off&#xA;&#xA;%% Knot choice for least squares approximation&#xA;% Knots must be selected when doing least-squares approximation by splines.&#xA;% One approach is to use equally spaced knots to begin with, then use NEWKNT&#xA;% with the approximation obtained for a better knot distribution.&#xA;%&#xA;% The next sections illustrate this with the full titanium heat data set.&#xA;&#xA;&#xA;%% Least squares approximation with uniform knot sequence&#xA;% We start with a uniform knot sequence.&#xA;&#xA;sp = spap2(augknt(linspace(xx(1), xx(end), 2+fix(length(xx)/4)),k),k, xx,yy);&#xA;fnplt(sp,'r'), hold on, plot(xx,yy,'x'), axis(frame)&#xA;title('Least-squares fit by cubic spline (red) with uniform knot sequence,')&#xA;&#xA;%%&#xA;% This is not at all satisfactory. So we use NEWKNT for a spline approximation&#xA;% of the same order and with the same number of polynomial pieces, but better&#xA;% distributed:&#xA;&#xA;%% Using NEWKNT to improve the knot distribution for these data&#xA;spgood = spap2( newknt(sp), k, xx,yy);&#xA;fnplt(spgood,'g',1.5)&#xA;xlabel('... and (green) with a knot sequence chosen from it by NEWKNT.')&#xA;hold off&#xA;%%&#xA;% This is quite good. Incidentally, one less interior knot would not have&#xA;% sufficed in this case.&#xA;"></originalCode>