<!--
This HTML is auto-generated from an m-file.
Your changes will be overwritten.
--><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:x-large">Cubic spline interpolation</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Illustration of the use of CSAPI and CSAPE.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"> Copyright 1987-2003 C. de Boor and The MathWorks, Inc.
  $Revision: 1.18 $
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium;">Overview</p><ul xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"><li><a href="#CSAPI">CSAPI</a></li><li><a href="#Two data points">Two data points</a></li><li><a href="#Three data points">Three data points</a></li><li><a href="#Four or more points">Four or more points</a></li><li><a href="#How to check CSAPI">How to check CSAPI</a></li><li><a href="#The truncated power">The truncated power</a></li><li><a href="#A particular truncated power">A particular truncated power</a></li><li><a href="#The particular truncated power interpolated">The particular truncated power interpolated</a></li><li><a href="#The error">The error</a></li><li><a href="#A truncated power that cannot be reproduced">A truncated power that cannot be reproduced</a></li><li><a href="#PPFORM instead of values">PPFORM instead of values</a></li><li><a href="#Differentiating the interpolant">Differentiating the interpolant</a></li><li><a href="#Error">Error</a></li><li><a href="#Second derivative">Second derivative</a></li><li><a href="#Integral">Integral</a></li><li><a href="#CSAPE">CSAPE</a></li><li><a href="#csapi(x,y) vs csape(x,y)">csapi(x,y) vs csape(x,y)</a></li><li><a href="#Other end conditions: the `natural' spline interpolant">Other end conditions: the `natural' spline interpolant</a></li><li><a href="#The `natural' spline interpolant: an example">The `natural' spline interpolant: an example</a></li><li><a href="#Other end conditions: prescribing second derivatives">Other end conditions: prescribing second derivatives</a></li><li><a href="#Other end conditions: prescribing slopes">Other end conditions: prescribing slopes</a></li><li><a href="#Other end conditions: mixed end conditions">Other end conditions: mixed end conditions</a></li><li><a href="#Other end conditions: periodic conditions">Other end conditions: periodic conditions</a></li><li><a href="#End conditions not explicitly covered by CSAPI or CSAPE">End conditions not explicitly covered by CSAPI or CSAPE</a></li></ul><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">CSAPI<a name="CSAPI"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The spline toolbox command
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">   values = csapi(x,y,xx)
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">returns the values at XX of the cubic spline interpolant to the
given data (X,Y), using the not-a-knot end condition.
This interpolant is a piecewise cubic with break sequence X whose cubic
pieces join together to form a function with two continuous derivatives.
The "not-a-knot" end condition means that, at the first and last interior
break, even the third derivative is continuous (up to roundoff).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Two data points<a name="Two data points"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Just two data points result in a straight line interpolant:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">xx = linspace(0,6,121); x = [0 1]; y = [2 0];
plot(xx,csapi(x,y,xx),<span style="color:#B20000">'k-'</span>,x,y,<span style="color:#B20000">'ro'</span>), grid off
title(<span style="color:#B20000">'Interpolant to two points'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_03_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Three data points<a name="Three data points"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Three data points give a parabola:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">x = [2 3 5]; y = [1 0 4];
plot(xx,csapi(x,y,xx),<span style="color:#B20000">'k-'</span>,x,y,<span style="color:#B20000">'ro'</span>), grid off
title(<span style="color:#B20000">'Interpolant to three points'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_04_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Four or more points<a name="Four or more points"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Four or more data points give in general a cubic spline.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">x = [1 1.5 2 4.1 5]; y = [1 -1 1 -1 1];
plot(xx,csapi(x,y,xx),<span style="color:#B20000">'k-'</span>,x,y,<span style="color:#B20000">'ro'</span>), grid off
title(<span style="color:#B20000">'Cubic spline interpolant to five points'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_05_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">How to check CSAPI<a name="How to check CSAPI"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">These look like nice interpolants, but how do we check that CSAPI
performs as advertised?
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We already saw that we interpolate, for we always plotted the data points
and the interpolant went right through those points.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">But, to be sure that we get a cubic spline, it is best to start with data
from a cubic spline of the expected sort and check whether CSAPI gives us
back that cubic spline.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">The truncated power<a name="The truncated power"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">One such is the truncated third power, i.e., the function
x |-&gt; subplus(x - xi)^3 , with XI one of the breaks and SUBPLUS
the  t r u n c a t i o n  f u n c t i o n, provided by the spline toolbox
command SUBPLUS:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">help subplus</pre><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:gray; font-style:italic;">
 SUBPLUS Positive part.
 
                                   x , if  x&gt;=0
    y  = subplus(x) := (x)_{+}  =               ,
                                   0 , if  x&lt;=0
 
   returns the positive part of X. Used for computing truncated powers.

</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">A particular truncated power<a name="A particular truncated power"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For the particular choice XI = 2 , we get the function plotted above.
As expected, it is zero to the left of 2, and rises like (x-2)^3 to the
right of 2.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">plot(xx, subplus(xx-2).^3,<span style="color:#B20000">'y'</span>,<span style="color:#B20000">'linewidth'</span>,3), grid off
axis([0,6,-10,70])</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_08_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">The particular truncated power interpolated<a name="The particular truncated power interpolated"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Now we interpolate this particular cubic spline at the data sites 0:6,
and plot the interpolant on top of the spline, in black.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">x = 0:6; y = subplus(x-2).^3;
values = csapi(x,y,xx);
hold on, plot(xx,values,<span style="color:#B20000">'k'</span>,x,y,<span style="color:#B20000">'ro'</span>), hold off
title(<span style="color:#B20000">'Interpolant to subplus(x-2)^3'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_09_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">The error<a name="The error"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">When comparing two functions, it is usually much more informative to plot
their difference. To put the size of their difference into context,
we also compute the maximum data value.
This shows the error to be no worse than the inevitable round-off.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">plot(xx,values-subplus(xx-2).^3)
title(<span style="color:#B20000">'Error in cubic spline interpolation to subplus(x-2)^3'</span>)

max_y=max(abs(y))</pre><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:gray; font-style:italic;">
max_y =

    64

</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_10_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">A truncated power that cannot be reproduced<a name="A truncated power that cannot be reproduced"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">As a further test, we interpolate a truncated power whose CSAPI interpolant
at the sites 0:6 cannot coincide with it.
For example, the first interior break of the interpolating spline is not
really a knot since the interpolant has three continuous derivatives there.
Hence we should not be able to reproduce the truncated power centered at
that site. We try
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">values = csapi(x,subplus(x-1).^3,xx);

plot(xx,values-subplus(xx-1).^3)
title(<span style="color:#B20000">'Error in not-a-knot interpolant to subplus(x-1)^3'</span>)
xlabel([<span style="color:#B20000">'since 1 is a first interior knot, it is not active for this'</span>,<span style="color:blue">...</span>
        <span style="color:#B20000">' interpolant'</span>])</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_11_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The difference is as large as .18, but decays rapidly as we move away from
1. This illustrates that cubic spline interpolation is essentially local.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">PPFORM instead of values<a name="PPFORM instead of values"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">It is possible to retain the interpolating cubic spline in a form
suitable for subsequent evaluation, or for calculating its derivatives,
or for other manipulations.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">This is done by calling CSAPI in the form
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">        pp = csapi(x,y)
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">which returns, in PP, the ppform of the interpolant. This form can be
evaluated at some points XX by
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">       values = fnval(pp,xx)
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">It can be differentiated by
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">      dpp = fnder(pp)
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">or integrated by
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">      ipp = fnint(pp)
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">which return, in DPP or IPP, the ppform of the derivative or the primitive,
respectively.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Differentiating the interpolant<a name="Differentiating the interpolant"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For example, we plot the derivative of this truncated power, i.e.,
x |-&gt; 3*subplus(x-2)^2 (again in yellow) and, on top of it,
the derivative of our interpolant (again in black).
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pp = csapi(x,subplus(x-2).^3); dpp = fnder(pp); 
plot(xx,fnval(dpp,xx),<span style="color:#B20000">'y'</span>,<span style="color:#B20000">'linewidth'</span>,3), hold on
plot(xx,3*subplus(xx-2).^2,<span style="color:#B20000">'k'</span>), hold off, grid off
title(<span style="color:#B20000">'Derivative of interpolant to subplus(x-2)^3'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_14_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Error<a name="Error"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Again, the more informative comparison is to plot their difference, and this
is again no bigger than round-off.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">plot(xx,fnval(dpp,xx)-3*subplus(xx-2).^2)
title(<span style="color:#B20000">'(derivative of interpolant to subplus(x-2)^3 )  - 3*subplus(x-2)^2'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_15_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Second derivative<a name="Second derivative"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The second derivative of the interpolant should be  6*subplus(.-2).
We try it, plotting above the difference between this function and the second
derivative of the interpolant to subplus(.-2)^3.
Now there are jumps, but they are still within roundoff.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">ddpp = fnder(dpp); plot(xx,fnval(ddpp,xx)-6*subplus(xx-2))
title(<span style="color:#B20000">'(second derivative of interpolant to subplus(x-2)^3 )  - 6*subplus(x-2)'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_16_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Integral<a name="Integral"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The integral of subplus(.-2)^3 is subplus(.-2)^4/4.
We plot the difference between it and the integral of the interpolant to
subplus(.-2)^3:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">ipp = fnint(pp);
plot(xx,fnval(ipp,xx)-subplus(xx-2).^4/4)
title(<span style="color:#B20000">'(integral of interpolant to subplus(x-2)^3 ) - subplus(x-2)^4/4'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_17_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">CSAPE<a name="CSAPE"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The command CSAPE also provides a cubic spline interpolant to given data,
but permits various other end conditions. It does not directly return values
of that interpolant, but only its ppform.  Its simplest version,
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">     pp = csape(x,y)
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">uses the Lagrange end conditions, which are better at times than the
not-a-knot condition used by CSAPI.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">csapi(x,y) vs csape(x,y)<a name="csapi(x,y) vs csape(x,y)"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For example, consider again interpolation to the truncated power which
CSAPI fails to reproduce. We plot here (in black), the error of the
not-a-knot interpolant, along with the error (in red) of the interpolant
obtained from CSAPE; -- not much difference between the two in this case.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">exact = subplus(xx-1).^3;
plot(xx, fnval( csapi(x,subplus(x-1).^3), xx ) - exact,<span style="color:#B20000">'k'</span>), hold on
plot(xx, fnval( csape(x,subplus(x-1).^3), xx ) - exact,<span style="color:#B20000">'r'</span>)
title(<span style="color:#B20000">'Error in not-a-knot (black) vs. Lagrange (red)'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_19_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Other end conditions: the `natural' spline interpolant<a name="Other end conditions: the `natural' spline interpolant"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The command CSAPE only provides the interpolating cubic spline in
ppform, but for several different end conditions. For example, the call
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">       pp = csape(x,y,'variational')
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">uses the so-called `natural' end conditions. This means that the
second derivative is zero at the two extreme breaks.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">The `natural' spline interpolant: an example<a name="The `natural' spline interpolant: an example"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We apply `natural' cubic spline interpolation to the truncated power we
were able to reproduce, and plot the error. We now get a large error near
the right end, due to the fact that we insisted on a zero second derivative
there. For variety, we get the `natural' spline interpolant here by the
command  csape(x,y,'second') which uses the default value 0 for the second
derivative at the extreme data sites.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pp = csape(x,subplus(x-2).^3,<span style="color:#B20000">'second'</span>);
plot(xx, fnval(pp,xx) - subplus(xx-2).^3 )
title(<span style="color:#B20000">'Error in ''natural'' spline interpolation to subplus(x-2)^3'</span>)
xlabel(<span style="color:#B20000">' note the large error near the right end'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_21_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Other end conditions: prescribing second derivatives<a name="Other end conditions: prescribing second derivatives"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">When we use explicitly the correct second derivatives, we get a small error,
as the above plot shows.
The command CSAPE(X,[VALS(1),Y VALS(2)],'second') specifies that second
derivatives are to be matched, with VALS(1) the second derivative at the
left endpoint, and VALS(2) the second derivative at the right.
We compute these values directly from the second derivative of the truncated
power subplus(.-2)^3.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pp = csape(x,[6*subplus(x(1)-2),subplus(x-2).^3,6*subplus(x(end)-2)], <span style="color:#B20000">'second'</span>);
plot(xx, fnval( pp, xx ) - subplus(xx-2).^3,<span style="color:#B20000">'r'</span>)
title(<span style="color:#B20000">'Error in spline interpolation to subplus(x-1)^3 when matching f'''' at ends '</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_22_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Other end conditions: prescribing slopes<a name="Other end conditions: prescribing slopes"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">CSAPE also permits specification of endpoint  s l o p e s . This is the
c l a m p e d  spline  (or,  c o m p l e t e  cubic spline interpolant).
The statement
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">       pp = csape(x,[sl,y,sr],'clamped')
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">supplies the cubic spline interpolant to the data X, Y that also has slope
SL at the leftmost data site and slope SR at the rightmost data site.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Other end conditions: mixed end conditions<a name="Other end conditions: mixed end conditions"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">It is even possible to mix these conditions. For example, our much
exercised truncated power function  f(x) = subplus(x-1)^3  has slope  0
at  x = 0   and second derivative  30  at  x = 6 (our last data site).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We therefore expect no error in the following interpolant:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pp = csape(x, [0,subplus(x-1).^3,30], [1 2] );
plot(xx, fnval(pp,xx) - subplus(xx-1).^3 )
title(<span style="color:#B20000">'Error in spline interpolation to subplus(x-1)^3 when matching  ...'</span>)
xlabel(<span style="color:#B20000">' ... slope at left end and curvature at right.'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_24_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Other end conditions: periodic conditions<a name="Other end conditions: periodic conditions"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">It is also possible to prescribe  p e r i o d i c  end conditions.
For example, the sine function is 2*pi periodic and has the values
[0 -1 0 1 0]  at the sites  (pi/2)*(-2:2) .
The difference, plotted above, between the sine function and its periodic
cubic spline interpolant at these sites, is only 2 percent. Not bad.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">x = (pi/2)*(-2:2);
y = [0 -1 0 1 0];
pp = csape(x,y, <span style="color:#B20000">'periodic'</span> );
xx = linspace(-pi,pi,201);
plot(xx, sin(xx) - fnval(pp,xx), <span style="color:#B20000">'x'</span>)
title(<span style="color:#B20000">'Error in periodic cubic spline interpolation to sin(x)'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_25_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">End conditions not explicitly covered by CSAPI or CSAPE<a name="End conditions not explicitly covered by CSAPI or CSAPE"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Any end condition not covered explicitly by CSAPI or CSAPE can be
handled by constructing the interpolant with the CSAPE default side
conditions, and then adding to it an appropriate scalar multiple of
an interpolant to zero values and some side conditions. If there are two
`nonstandard' side conditions to be satisfied, one may have to solve a
2x2 linear system first.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For example, suppose that you want to enforce the condition
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">       lambda(s)  :=  a (Ds)(e)  + b (D^2 s)(e) = c
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">on the cubic spline interpolant  s  to the following data (taken from a
a quartic polynomial that happens to satisfy this specific side condition):
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">q = inline(<span style="color:#B20000">'x.*(-1 + x.*(-1+x.*x/5))'</span>);
x = 0:.25:3; y = q(x);

e = x(1); a = 2; b = -3; c = 4;</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Then, in addition to the interpolant PP1 with the default end conditions ...
 pp1 = csape(x,y);
... and first derivative DP1 of its first polynomial piece ...
 dp1 = fnder( fnbrk(pp1,1) );
... we also construct the cubic spline interpolant PP0 to zero data,
and with a slope of  1  at E, as well as the first derivative DP0 of its
first polynomial piece.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pp1 = csape(x,y);
dp1 = fnder(fnbrk(pp1,1));

pp0 = csape(x,[1,zeros(size(y)),0], [1,0] );
dp0 = fnder( fnbrk(pp0,1) );</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Then we compute  lambda(s)  for both  s = PP1  and  s = PP0  ...
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"> lam1 := a*fnval(dp1,e) + b*fnval(fnder(dp1),e);
  lam0 := a*fnval(dp0,e) + b*fnval(fnder(dp0),e);
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">... and construct the right linear combination of PP1 and
PP0 to get a cubic spline
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">pp  :=  pp1 + ( (c - lambda(pp1))/lambda(pp0) )* pp0
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">that does satisfy the desired condition (as well as the default end
condition at the right endpoint).
We form this linear combination with the help of FNCMB.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">lam1 = a*fnval(dp1,e) + b*fnval(fnder(dp1),e);
lam0 = a*fnval(dp0,e) + b*fnval(fnder(dp0),e);

pp = fncmb(pp0,(c-lam1)/lam0,pp1);</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The plot shows that PP fits our quartic polynomial slightly better near E
than does the interpolant PP1 with the default conditions ...
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">xx = (-.3):.05:.7; yy = q(xx);
plot(xx, fnval(pp1,xx) - yy, <span style="color:#B20000">'x'</span>)
hold on
plot(xx, fnval(pp,xx) - yy, <span style="color:#B20000">'o'</span>)
title(<span style="color:#B20000">'Default (x) vs. nonstardard (o)'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_29_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">If we also want to enforce the condition
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">  mu(s) := (D^3 s)(3) = 14.6
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">(which our quartic also satisfies), then we construct an additional cubic
spline interpolating to zero values, and with zero first derivative at
the left endpoint, hence certain to be independent from PP0, as
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">  pp2 = csape(x,[0,zeros(size(y)),1],[0,1]);
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">and solve the linear system for the coefficients D0 and D1 in the linear
combination    pp :=  pp1 + d0 * pp0  + d2 * pp2
for which  lambda(pp) = c, mu(pp) = 14.6 . (Note that both PP0 and
PP2 vanish at all interpolation sites, hence PP will match the
given data for any choice of  D0  and  D2 ).
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">pp2 = csape(x,[0,zeros(size(y)),1],[0,1]);</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For amusement, we use the MATLAB encoding facility to write a loop
for computing  lambda(PPj), and mu(PPj), for j=0:2
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">dd = zeros(2,3);
<span style="color:blue">for</span> j=0:2
   J = num2str(j);
   eval([<span style="color:#B20000">'dpp'</span>,J,<span style="color:#B20000">'=fnder(pp'</span>,J,<span style="color:#B20000">');'</span>]);
   eval([<span style="color:#B20000">'ddpp'</span>,J,<span style="color:#B20000">'=fnder(dpp'</span>,J,<span style="color:#B20000">');'</span>]);
   eval([<span style="color:#B20000">'dd(1,1+'</span>,J,<span style="color:#B20000">')=a*fnval(dpp'</span>,J,<span style="color:#B20000">',e)+b*fnval(ddpp'</span>,J,<span style="color:#B20000">',e);'</span>]);
   eval([<span style="color:#B20000">'dd(2,1+'</span>,J,<span style="color:#B20000">')=fnval(fnder(ddpp'</span>,J,<span style="color:#B20000">'),3);'</span>]);
<span style="color:blue">end</span>

d = dd(:,[1,3])\([c;14.6]-dd(:,2));
pp = fncmb(fncmb(pp0,d(1),pp2,d(2)),pp1);

xxx = 0:.05:3;
yyy = q(xxx);
plot(xxx, yyy - fnval(pp,xxx),<span style="color:#B20000">'x'</span>)
title(<span style="color:#B20000">'Error in spline interpolant to y = x.*(-1 + x.*(-1+x.*x/5))'</span>)</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_31_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For reassurance, we compare this error with the one obtained in complete
cubic spline interpolation to this function:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">hold on
plot(xxx, yyy - fnval(csape(x,[-1,y,-7+(4/5)*27],<span style="color:#B20000">'clamped'</span>),xxx),<span style="color:#B20000">'o'</span>)
title(<span style="color:#B20000">'Nonstandard (x) vs endslopes (o)'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="csapidem_img_32_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The errors differ (and not by much) only near the end points, testifying
to the fact that both PP0 and PP2 are sizable only near their respective
end points.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px"><span style="color:green">% As a final check, here is the third derivative of PP at 3 (which</span>
<span style="color:green">% should be  14.6 ):</span>

fnval(fnder(pp,3),3)</pre><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:gray; font-style:italic;">
ans =

   14.6000

</pre><originalCode xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" code="%%             Cubic spline interpolation&#xA;%&#xA;% Illustration of the use of CSAPI and CSAPE.&#xA;%&#xA;%   Copyright 1987-2003 C. de Boor and The MathWorks, Inc.&#xA;%   $Revision: 1.18 $&#xA;&#xA;%% CSAPI&#xA;% The spline toolbox command &#xA;%&#xA;%     values = csapi(x,y,xx)&#xA;%&#xA;% returns the values at XX of the cubic spline interpolant to the&#xA;% given data (X,Y), using the not-a-knot end condition.&#xA;% This interpolant is a piecewise cubic with break sequence X whose cubic&#xA;% pieces join together to form a function with two continuous derivatives.&#xA;% The &#34;not-a-knot&#34; end condition means that, at the first and last interior&#xA;% break, even the third derivative is continuous (up to roundoff).&#xA;&#xA;%% Two data points&#xA;%&#xA;% Just two data points result in a straight line interpolant:&#xA;&#xA;xx = linspace(0,6,121); x = [0 1]; y = [2 0];&#xA;plot(xx,csapi(x,y,xx),'k-',x,y,'ro'), grid off&#xA;title('Interpolant to two points')&#xA;&#xA;%% Three data points&#xA;%&#xA;% Three data points give a parabola:&#xA;&#xA;x = [2 3 5]; y = [1 0 4];&#xA;plot(xx,csapi(x,y,xx),'k-',x,y,'ro'), grid off&#xA;title('Interpolant to three points')&#xA;&#xA;%% Four or more points&#xA;% Four or more data points give in general a cubic spline.&#xA;&#xA;x = [1 1.5 2 4.1 5]; y = [1 -1 1 -1 1];&#xA;plot(xx,csapi(x,y,xx),'k-',x,y,'ro'), grid off&#xA;title('Cubic spline interpolant to five points')&#xA;&#xA;%% How to check CSAPI&#xA;% These look like nice interpolants, but how do we check that CSAPI&#xA;% performs as advertised?&#xA;%&#xA;% We already saw that we interpolate, for we always plotted the data points&#xA;% and the interpolant went right through those points.&#xA;%&#xA;% But, to be sure that we get a cubic spline, it is best to start with data &#xA;% from a cubic spline of the expected sort and check whether CSAPI gives us&#xA;% back that cubic spline.&#xA;&#xA;%% The truncated power&#xA;% One such is the truncated third power, i.e., the function&#xA;% x |-&gt; subplus(x - xi)^3 , with XI one of the breaks and SUBPLUS&#xA;% the  t r u n c a t i o n  f u n c t i o n, provided by the spline toolbox&#xA;% command SUBPLUS:&#xA;&#xA;&#xA;help subplus&#xA;&#xA;%% A particular truncated power&#xA;% For the particular choice XI = 2 , we get the function plotted above. &#xA;% As expected, it is zero to the left of 2, and rises like (x-2)^3 to the&#xA;% right of 2.&#xA;&#xA;plot(xx, subplus(xx-2).^3,'y','linewidth',3), grid off&#xA;axis([0,6,-10,70])&#xA;&#xA;%% The particular truncated power interpolated&#xA;% Now we interpolate this particular cubic spline at the data sites 0:6,&#xA;% and plot the interpolant on top of the spline, in black.&#xA;&#xA;x = 0:6; y = subplus(x-2).^3;&#xA;values = csapi(x,y,xx);&#xA;hold on, plot(xx,values,'k',x,y,'ro'), hold off&#xA;title('Interpolant to subplus(x-2)^3')&#xA;&#xA;%% The error&#xA;% When comparing two functions, it is usually much more informative to plot&#xA;% their difference. To put the size of their difference into context,&#xA;% we also compute the maximum data value. &#xA;% This shows the error to be no worse than the inevitable round-off.&#xA;&#xA;plot(xx,values-subplus(xx-2).^3)&#xA;title('Error in cubic spline interpolation to subplus(x-2)^3')&#xA;&#xA;max_y=max(abs(y))&#xA;&#xA;%% A truncated power that cannot be reproduced&#xA;% As a further test, we interpolate a truncated power whose CSAPI interpolant&#xA;% at the sites 0:6 cannot coincide with it.&#xA;% For example, the first interior break of the interpolating spline is not &#xA;% really a knot since the interpolant has three continuous derivatives there. &#xA;% Hence we should not be able to reproduce the truncated power centered at &#xA;% that site. We try &#xA;&#xA;values = csapi(x,subplus(x-1).^3,xx);&#xA;&#xA;plot(xx,values-subplus(xx-1).^3)&#xA;title('Error in not-a-knot interpolant to subplus(x-1)^3')&#xA;xlabel(['since 1 is a first interior knot, it is not active for this',...&#xA;        ' interpolant'])&#xA;%% &#xA;% The difference is as large as .18, but decays rapidly as we move away from&#xA;% 1. This illustrates that cubic spline interpolation is essentially local.&#xA;&#xA;%% PPFORM instead of values&#xA;% It is possible to retain the interpolating cubic spline in a form&#xA;% suitable for subsequent evaluation, or for calculating its derivatives,&#xA;% or for other manipulations.&#xA;%&#xA;% This is done by calling CSAPI in the form&#xA;%&#xA;%          pp = csapi(x,y)&#xA;%&#xA;% which returns, in PP, the ppform of the interpolant. This form can be&#xA;% evaluated at some points XX by&#xA;%&#xA;%         values = fnval(pp,xx)&#xA;%&#xA;% It can be differentiated by&#xA;%&#xA;%        dpp = fnder(pp)&#xA;%&#xA;% or integrated by&#xA;%&#xA;%        ipp = fnint(pp)&#xA;%&#xA;% which return, in DPP or IPP, the ppform of the derivative or the primitive,&#xA;% respectively.&#xA;&#xA;%% Differentiating the interpolant&#xA;% For example, we plot the derivative of this truncated power, i.e.,&#xA;% x |-&gt; 3*subplus(x-2)^2 (again in yellow) and, on top of it, &#xA;% the derivative of our interpolant (again in black).&#xA;&#xA;pp = csapi(x,subplus(x-2).^3); dpp = fnder(pp); &#xA;plot(xx,fnval(dpp,xx),'y','linewidth',3), hold on&#xA;plot(xx,3*subplus(xx-2).^2,'k'), hold off, grid off&#xA;title('Derivative of interpolant to subplus(x-2)^3')&#xA;&#xA;%% Error&#xA;% Again, the more informative comparison is to plot their difference, and this&#xA;% is again no bigger than round-off.&#xA;&#xA;plot(xx,fnval(dpp,xx)-3*subplus(xx-2).^2)&#xA;title('(derivative of interpolant to subplus(x-2)^3 )  - 3*subplus(x-2)^2')&#xA;&#xA;%% Second derivative&#xA;%&#xA;% The second derivative of the interpolant should be  6*subplus(.-2).&#xA;% We try it, plotting above the difference between this function and the second&#xA;% derivative of the interpolant to subplus(.-2)^3.&#xA;% Now there are jumps, but they are still within roundoff.&#xA;&#xA;ddpp = fnder(dpp); plot(xx,fnval(ddpp,xx)-6*subplus(xx-2))&#xA;title('(second derivative of interpolant to subplus(x-2)^3 )  - 6*subplus(x-2)')&#xA;&#xA;%% Integral&#xA;%&#xA;% The integral of subplus(.-2)^3 is subplus(.-2)^4/4. &#xA;% We plot the difference between it and the integral of the interpolant to&#xA;% subplus(.-2)^3:&#xA;&#xA;ipp = fnint(pp);&#xA;plot(xx,fnval(ipp,xx)-subplus(xx-2).^4/4)&#xA;title('(integral of interpolant to subplus(x-2)^3 ) - subplus(x-2)^4/4')&#xA;&#xA;%% CSAPE&#xA;%&#xA;% The command CSAPE also provides a cubic spline interpolant to given data,&#xA;% but permits various other end conditions. It does not directly return values&#xA;% of that interpolant, but only its ppform.  Its simplest version,&#xA;%&#xA;%       pp = csape(x,y)&#xA;%&#xA;% uses the Lagrange end conditions, which are better at times than the&#xA;% not-a-knot condition used by CSAPI.&#xA;&#xA;&#xA;%% csapi(x,y) vs csape(x,y)&#xA;% For example, consider again interpolation to the truncated power which&#xA;% CSAPI fails to reproduce. We plot here (in black), the error of the&#xA;% not-a-knot interpolant, along with the error (in red) of the interpolant&#xA;% obtained from CSAPE; -- not much difference between the two in this case.&#xA;&#xA;exact = subplus(xx-1).^3;&#xA;plot(xx, fnval( csapi(x,subplus(x-1).^3), xx ) - exact,'k'), hold on&#xA;plot(xx, fnval( csape(x,subplus(x-1).^3), xx ) - exact,'r')&#xA;title('Error in not-a-knot (black) vs. Lagrange (red)')&#xA;hold off&#xA;&#xA;%% Other end conditions: the `natural' spline interpolant&#xA;%&#xA;% The command CSAPE only provides the interpolating cubic spline in&#xA;% ppform, but for several different end conditions. For example, the call&#xA;%&#xA;%         pp = csape(x,y,'variational')&#xA;%&#xA;% uses the so-called `natural' end conditions. This means that the &#xA;% second derivative is zero at the two extreme breaks. &#xA;&#xA;&#xA;%% The `natural' spline interpolant: an example&#xA;% We apply `natural' cubic spline interpolation to the truncated power we&#xA;% were able to reproduce, and plot the error. We now get a large error near&#xA;% the right end, due to the fact that we insisted on a zero second derivative&#xA;% there. For variety, we get the `natural' spline interpolant here by the&#xA;% command  csape(x,y,'second') which uses the default value 0 for the second&#xA;% derivative at the extreme data sites.&#xA;&#xA;pp = csape(x,subplus(x-2).^3,'second');&#xA;plot(xx, fnval(pp,xx) - subplus(xx-2).^3 )&#xA;title('Error in ''natural'' spline interpolation to subplus(x-2)^3')&#xA;xlabel(' note the large error near the right end')&#xA;&#xA;%% Other end conditions: prescribing second derivatives&#xA;% When we use explicitly the correct second derivatives, we get a small error,&#xA;% as the above plot shows.&#xA;% The command CSAPE(X,[VALS(1),Y VALS(2)],'second') specifies that second &#xA;% derivatives are to be matched, with VALS(1) the second derivative at the &#xA;% left endpoint, and VALS(2) the second derivative at the right.&#xA;% We compute these values directly from the second derivative of the truncated&#xA;% power subplus(.-2)^3.&#xA;&#xA;pp = csape(x,[6*subplus(x(1)-2),subplus(x-2).^3,6*subplus(x(end)-2)], 'second');&#xA;plot(xx, fnval( pp, xx ) - subplus(xx-2).^3,'r')&#xA;title('Error in spline interpolation to subplus(x-1)^3 when matching f'''' at ends ')&#xA;&#xA;%% Other end conditions: prescribing slopes&#xA;% CSAPE also permits specification of endpoint  s l o p e s . This is the&#xA;% c l a m p e d  spline  (or,  c o m p l e t e  cubic spline interpolant).&#xA;% The statement&#xA;%&#xA;%         pp = csape(x,[sl,y,sr],'clamped')&#xA;%&#xA;% supplies the cubic spline interpolant to the data X, Y that also has slope&#xA;% SL at the leftmost data site and slope SR at the rightmost data site.&#xA;&#xA;&#xA;%% Other end conditions: mixed end conditions&#xA;% It is even possible to mix these conditions. For example, our much&#xA;% exercised truncated power function  f(x) = subplus(x-1)^3  has slope  0&#xA;% at  x = 0   and second derivative  30  at  x = 6 (our last data site).&#xA;%&#xA;% We therefore expect no error in the following interpolant:&#xA;&#xA;pp = csape(x, [0,subplus(x-1).^3,30], [1 2] );&#xA;plot(xx, fnval(pp,xx) - subplus(xx-1).^3 )&#xA;title('Error in spline interpolation to subplus(x-1)^3 when matching  ...')&#xA;xlabel(' ... slope at left end and curvature at right.')&#xA;&#xA;%% Other end conditions: periodic conditions&#xA;% It is also possible to prescribe  p e r i o d i c  end conditions.&#xA;% For example, the sine function is 2*pi periodic and has the values&#xA;% [0 -1 0 1 0]  at the sites  (pi/2)*(-2:2) .&#xA;% The difference, plotted above, between the sine function and its periodic&#xA;% cubic spline interpolant at these sites, is only 2 percent. Not bad.&#xA;x = (pi/2)*(-2:2);&#xA;y = [0 -1 0 1 0];&#xA;pp = csape(x,y, 'periodic' );&#xA;xx = linspace(-pi,pi,201);&#xA;plot(xx, sin(xx) - fnval(pp,xx), 'x')&#xA;title('Error in periodic cubic spline interpolation to sin(x)')&#xA;&#xA;%% End conditions not explicitly covered by CSAPI or CSAPE&#xA;% Any end condition not covered explicitly by CSAPI or CSAPE can be&#xA;% handled by constructing the interpolant with the CSAPE default side&#xA;% conditions, and then adding to it an appropriate scalar multiple of&#xA;% an interpolant to zero values and some side conditions. If there are two&#xA;% `nonstandard' side conditions to be satisfied, one may have to solve a&#xA;% 2x2 linear system first.&#xA;%&#xA;% For example, suppose that you want to enforce the condition&#xA;%&#xA;%         lambda(s)  :=  a (Ds)(e)  + b (D^2 s)(e) = c&#xA;%&#xA;% on the cubic spline interpolant  s  to the following data (taken from a &#xA;% a quartic polynomial that happens to satisfy this specific side condition):&#xA;&#xA;&#xA;q = inline('x.*(-1 + x.*(-1+x.*x/5))');&#xA;x = 0:.25:3; y = q(x);&#xA;&#xA;e = x(1); a = 2; b = -3; c = 4;&#xA;&#xA;%%&#xA;% Then, in addition to the interpolant PP1 with the default end conditions ...&#xA;%  pp1 = csape(x,y);&#xA;% ... and first derivative DP1 of its first polynomial piece ...&#xA;%  dp1 = fnder( fnbrk(pp1,1) );&#xA;% ... we also construct the cubic spline interpolant PP0 to zero data,&#xA;% and with a slope of  1  at E, as well as the first derivative DP0 of its&#xA;% first polynomial piece.&#xA;&#xA;pp1 = csape(x,y);&#xA;dp1 = fnder(fnbrk(pp1,1));&#xA;&#xA;pp0 = csape(x,[1,zeros(size(y)),0], [1,0] );&#xA;dp0 = fnder( fnbrk(pp0,1) );&#xA;&#xA;%%&#xA;% Then we compute  lambda(s)  for both  s = PP1  and  s = PP0  ...&#xA;%&#xA;%   lam1 := a*fnval(dp1,e) + b*fnval(fnder(dp1),e);&#xA;%   lam0 := a*fnval(dp0,e) + b*fnval(fnder(dp0),e);&#xA;%&#xA;% ... and construct the right linear combination of PP1 and&#xA;% PP0 to get a cubic spline&#xA;%&#xA;%  pp  :=  pp1 + ( (c - lambda(pp1))/lambda(pp0) )* pp0&#xA;%&#xA;% that does satisfy the desired condition (as well as the default end&#xA;% condition at the right endpoint).&#xA;% We form this linear combination with the help of FNCMB.&#xA;&#xA;lam1 = a*fnval(dp1,e) + b*fnval(fnder(dp1),e);&#xA;lam0 = a*fnval(dp0,e) + b*fnval(fnder(dp0),e);&#xA;&#xA;pp = fncmb(pp0,(c-lam1)/lam0,pp1);&#xA;&#xA;%%&#xA;% The plot shows that PP fits our quartic polynomial slightly better near E&#xA;% than does the interpolant PP1 with the default conditions ...&#xA;&#xA;xx = (-.3):.05:.7; yy = q(xx);&#xA;plot(xx, fnval(pp1,xx) - yy, 'x')&#xA;hold on&#xA;plot(xx, fnval(pp,xx) - yy, 'o')&#xA;title('Default (x) vs. nonstardard (o)')&#xA;hold off&#xA;&#xA;%%&#xA;% If we also want to enforce the condition&#xA;%&#xA;%    mu(s) := (D^3 s)(3) = 14.6&#xA;%&#xA;% (which our quartic also satisfies), then we construct an additional cubic&#xA;% spline interpolating to zero values, and with zero first derivative at&#xA;% the left endpoint, hence certain to be independent from PP0, as&#xA;%&#xA;%    pp2 = csape(x,[0,zeros(size(y)),1],[0,1]);&#xA;%&#xA;% and solve the linear system for the coefficients D0 and D1 in the linear&#xA;% combination    pp :=  pp1 + d0 * pp0  + d2 * pp2&#xA;% for which  lambda(pp) = c, mu(pp) = 14.6 . (Note that both PP0 and&#xA;% PP2 vanish at all interpolation sites, hence PP will match the&#xA;% given data for any choice of  D0  and  D2 ).&#xA;&#xA;pp2 = csape(x,[0,zeros(size(y)),1],[0,1]);&#xA;&#xA;%%&#xA;% For amusement, we use the MATLAB encoding facility to write a loop&#xA;% for computing  lambda(PPj), and mu(PPj), for j=0:2&#xA;&#xA;dd = zeros(2,3);&#xA;for j=0:2&#xA;   J = num2str(j);&#xA;   eval(['dpp',J,'=fnder(pp',J,');']);&#xA;   eval(['ddpp',J,'=fnder(dpp',J,');']);&#xA;   eval(['dd(1,1+',J,')=a*fnval(dpp',J,',e)+b*fnval(ddpp',J,',e);']);&#xA;   eval(['dd(2,1+',J,')=fnval(fnder(ddpp',J,'),3);']);&#xA;end&#xA;&#xA;d = dd(:,[1,3])\([c;14.6]-dd(:,2));&#xA;pp = fncmb(fncmb(pp0,d(1),pp2,d(2)),pp1);&#xA;&#xA;xxx = 0:.05:3;&#xA;yyy = q(xxx);&#xA;plot(xxx, yyy - fnval(pp,xxx),'x')&#xA;title('Error in spline interpolant to y = x.*(-1 + x.*(-1+x.*x/5))')&#xA;&#xA;%%&#xA;% For reassurance, we compare this error with the one obtained in complete&#xA;% cubic spline interpolation to this function:&#xA;&#xA;hold on&#xA;plot(xxx, yyy - fnval(csape(x,[-1,y,-7+(4/5)*27],'clamped'),xxx),'o')&#xA;title('Nonstandard (x) vs endslopes (o)')&#xA;hold off&#xA;&#xA;%%&#xA;% The errors differ (and not by much) only near the end points, testifying&#xA;% to the fact that both PP0 and PP2 are sizable only near their respective&#xA;% end points.&#xA;&#xA;% As a final check, here is the third derivative of PP at 3 (which&#xA;% should be  14.6 ):&#xA;&#xA;fnval(fnder(pp,3),3)&#xA;"></originalCode>