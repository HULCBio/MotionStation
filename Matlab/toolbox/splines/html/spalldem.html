<!--
This HTML is auto-generated from an m-file.
Your changes will be overwritten.
--><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:x-large">Intro to B-form</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">A quick introduction to the B-form.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Copyright 1987-2003 C. de Boor and The MathWorks, Inc.
$Revision: 1.22 $  $Date: 2003/02/13 23:15:21 $
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium;">Overview</p><ul xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd"><li><a href="#Local partition of unity and convex hull property">Local partition of unity and convex hull property</a></li><li><a href="#Convex hull property (cont.) and  control polygon">Convex hull property (cont.) and  control polygon</a></li><li><a href="#CONTROL POLYGON (cont.)">CONTROL POLYGON (cont.)</a></li><li><a href="#REFINEMENT and KNOT INSERTION">REFINEMENT and KNOT INSERTION</a></li><li><a href="#REFINEMENT and KNOT INSERTION (cont.)">REFINEMENT and KNOT INSERTION (cont.)</a></li><li><a href="#REFINEMENT and KNOT INSERTION (cont.)">REFINEMENT and KNOT INSERTION (cont.)</a></li><li><a href="#MULTIVARIATE SPLINES">MULTIVARIATE SPLINES</a></li></ul><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">In this toolbox, a pp function in B-form is often called a SPLINE.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The  B-FORM  of a (univariate) pp is specified
by its (nondecreasing)  k n o t  sequence  t  and
by its B-spline  c o e f f i c i e n t  sequence  a .
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">SPMAK(t,a) returns the corresponding B-form, for use in FN... commands.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The resulting spline is of  o r d e r   k := LENGTH(t) - SIZE(a,2).
This means that all its polynomial pieces have degree &lt; k.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">t = [.1 .4 .5 .8 .9];
fnplt(spmak(t,1),2.5); 
tmp = repmat(t,3,1); 
ty = repmat(.1*[1;-1;NaN],1,5);
hold on
plot(tmp(:),ty(:))
text(.65,.5,<span style="color:#B20000">'B( \cdot | .1, .4, .5, .8, .9)'</span>,<span style="color:#B20000">'Fontsize'</span>,10)
text(.02,1.,<span style="color:#B20000">'s(x)  =  \Sigma_j  B( x | t_j , \ldots, t_{j+k} ) a(:,j)'</span>,<span style="color:#B20000">'Fontsize'</span>,18,<span style="color:#B20000">'color'</span>,<span style="color:#B20000">'r'</span>)
axis([0 1 -.2 1.2])
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_02_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">To say that  s  has knots  t  and coefficients  a  means that
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">          n
 s(x)  := sum  B_{j,k}(x) * a(:,j) , with B_(j,k) = B( . | t_j, ..., t_{j+k} )
         j = 1
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">the j-th B-SPLINE of ORDER  k  for the given KNOT SEQUENCE  t  ,
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">i.e., the B-spline with knots  t_j, ..., t_{j+k} ; see the sample B-spline above.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Local partition of unity and convex hull property<a name="Local partition of unity and convex hull property"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The value of the spline  s(x) = sum_j B_{j,K}(x) a(:,j)  at any x in the
knot interval  [t_i .. t_{i+1}]  is a CONVEX combination of the  k
coefficients a(:.i-k+1), ..., a(:,i)  since, on that interval, only the  k
B-splines  B_{i-k+1,k}, ..., B_{i,k} are nonzero, and they are nonnegative
there and sum to 1.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">This is often summarized by saying that the B-splines provide a
  LOCAL  (nonnegative)  PARTITION  of  UNITY .
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">k = 3; 
n = 3; 
t = [1 1.7 3.2 4.2 4.8 6]; 
tt = (10:60)/10;
vals = fnval(spmak(t,eye(k)),tt); 
plot(tt.',vals.');
hold on
ind = find(tt&gt;=t(3)&amp;tt&lt;=t(4));
plot(tt(ind).',vals(:,ind).',<span style="color:#B20000">'linewi'</span>,3)
plot(t([3 4]),[1 1],<span style="color:#B20000">'w'</span>,<span style="color:#B20000">'linewi'</span>,3)
axis([-.5 7 -.5 1.5])
ty = repmat(.1*[1;-1;NaN],1,6);
plot([0 0 -.2 0 0 -.2 0 0],[-.5 0 0 0 1 1 1 1.5],<span style="color:#B20000">'k'</span>)
text(-.5,0,<span style="color:#B20000">'0'</span>)
text(-.5,1,<span style="color:#B20000">'1'</span>)
tmp = repmat(t,3,1);
plot(tmp(:),ty(:),<span style="color:#B20000">'k'</span>);
yd = -.25; text(t(1),yd,<span style="color:#B20000">'t_{i-2}'</span>); 
text(t(3),yd,<span style="color:#B20000">'t_i'</span>);
text(t(4),yd,<span style="color:#B20000">'t_{i+1}'</span>);
text(1.8,.5,<span style="color:#B20000">'B_{i-2,3}'</span>); 
text(5,.45,<span style="color:#B20000">'B_{i,3}'</span>);
axis off
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_04_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">Convex hull property (cont.) and  control polygon<a name="Convex hull property (cont.) and  control polygon"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">When the coefficients are points in the plane and, correspondingly, the spline
s(x) = sum_j B_{j,k}(x) a(:,j)  traces out a curve, this means that the curve piece
{ s(x) : t_i &lt;= x &lt;= t_{i+1} } lies in the convex hull (shown in yellow above)
of the  k  points a(:,i-k+1), ... a(:,i).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For a quadratic spline (i.e., k = 3), as shown here, it even means that
the curve is tangent to the   CONTROL POLYGON   (shown in black dashes).
This is the broken line that connects the coefficients (which are called
 CONTROL POINTS  in this connection and shown here as open circles).
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">t = 1:9; 
c = [2 1.4;1 .5; 2 -.4; 5 1.4; 6 .5; 5 -.4].';
sp = spmak(t,c);
fill(c(1,3:5),c(2,3:5),<span style="color:#B20000">'y'</span>,<span style="color:#B20000">'edgecolor'</span>,<span style="color:#B20000">'y'</span>); 
hold on
fnplt(sp,t([3 7]),1.5)
fnplt(sp,t([5 6]),3)
plot(c(1,:),c(2,:),<span style="color:#B20000">':ok'</span>)
axis([.5 7 -.8 1.8])
axis off
text(2,-.55,<span style="color:#B20000">'a(:,i-2)'</span>)
text(5,1.6,<span style="color:#B20000">'a(:,i-1)'</span>)
text(6.1,.5,<span style="color:#B20000">'a(:,i)'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_05_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">CONTROL POLYGON (cont.)<a name="CONTROL POLYGON (cont.)"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">We can think of the graph of the SCALAR-valued spline  s = sum_j B_{j,k}*a(j)
as the curve  x |--&gt; (x,s(x)) .   Since   x  =  sum_j  B_{j,k}(x) t^*_j
for  x  in the interval  [t_k .. t_{n+1}] and with
        t^*_i : =  (t_{i+1} + ... + t_{i+k-1})/(k-1),    i = 1:n,
the knot averages obtainable by  AVEKNT(t,k) , the  CONTROL  POLYGON  for a
scalar-valued spline is the broken line with vertices (t^*_i, a(i)), i=1:n.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The example shows a  CUBIC  spline (k = 4), with 4-fold end knots, hence
t^*_1 = t_1  and  t^*_n = t_{n+k} .
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">t = [0 .2 .35 .47 .61 .84 1]*(2*pi); 
s=t([1 3 4 5 7]);
knots = augknt(s,4);
sp = spapi(knots,t,sin(t)+1.8);
fnplt(sp,2); 
hold on
c = fnbrk(sp,<span style="color:#B20000">'c'</span>); 
ts = aveknt(knots,4);
plot(ts,c,<span style="color:#B20000">':ok'</span>)
tt = [s;s;repmat(NaN,size(s))];
ty = repmat(.25*[-1;1;NaN], size(s));
plot(tt(:),ty(:),<span style="color:#B20000">'r'</span>)
plot(ts(1,:),zeros(size(ts)),<span style="color:#B20000">'*'</span>)
text(knots(5),-.5,<span style="color:#B20000">'t_5'</span>)
text(ts(2),-.45,<span style="color:#B20000">'t^*_2'</span>)
text(knots(1)-.28,-.5,<span style="color:#B20000">'t_1=t_4'</span>)
text(knots(end)-.65,-.45,<span style="color:#B20000">'t_{n+1}=t^*_n=t_{n+4}'</span>)
axis([-.72 7 -.5 3.5])
axis off
hold off
savesp = sp;</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_06_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The essential parts of the B-form are the knot sequence t and the B-spline
coefficient sequence a . Other parts are the  NUMBER   n  of the B-splines
or coefficients involved , the  ORDER  k  of its polynomial pieces, and the
DIMENSION  d  of its coefficients. In particular,  size(a)  equals  [d,n] .
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">There is one more part, namely the  BASIC INTERVAL , [ t(1) ..  t(end) ].
It is used as the default interval when plotting the function.  Also,
while the spline is taken to be continuous from the right, it is made
continuous from the left at the right endpoint of the basic interval, as
illustrated above, where values of the spline made by
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">&gt;&gt; sp = spmak(augknt(0:3,3),[-1,0,1,0,-1]);
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">are plotted.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">b = 0:3; 
sp = spmak(augknt(b,3),[-1,0,1,0,-1]);
x = linspace(-1,4,51);
plot(x,fnval(sp,x),<span style="color:#B20000">'x'</span>)
hold on
axis([-2 5,-1.5,1])
tx = repmat(b,3,1); 
ty = repmat(.15*[1;-1;NaN],1,length(b));
plot(tx(:),ty(:),<span style="color:#B20000">'-r'</span>) 
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_07_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">FNBRK can be used to obtain any or all parts of a B-form. For example,
here is the output provided by FNBRK(SP), with SP the B-form of the
spline shown above:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">knots(1:n+k)                    0     0     0     1     2     3     3     3
 coefficients(d,n)              -1     0     1     0    -1
 number n of coefficients  5
 order k                            3
 dimension  d  of target     1
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">However, there is usually NO NEED to know any of these parts. Rather,
one uses commands like  SP = SPAPI(...)  or  SP = SPAPS(...)  to
construct the B-form of a spline from some data, then uses commands like
FNVAL(SP,...), FNPLT(SP,...), FNDER(SP)  etc., to make use of the spline
constructed, without any need to look at its various parts.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The next slides give more detailed information about the  B-splines, in
particular about the important role played by knot  MULTIPLICITY .
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">b = 0:3; 
sp = spmak(augknt(b,3),[-1,0,1,0,-1]);
x = linspace(-1,4,51);
plot(x,fnval(sp,x),<span style="color:#B20000">'x'</span>), 
hold on, 
axis([-2 5,-1.5,1]),
tx = repmat(b,3,1); 
ty = repmat(.15*[1;-1;NaN],1,length(b));
plot(tx(:),ty(:),<span style="color:#B20000">'-r'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_08_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Here, for  k=2,3,4, is a B-spline of order  k , and below it its first
and second (piecewise) derivative, to illustrate the following facts (try
out the BSPLIGUI if you want to experiment with examples of your own).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">1. The B-spline  B_{j,k} = B( . | t_j, ..., t_{j+k})  is pp of order k
with breaks at t_j, ..., t_{j+k}  (and nowhere else). Actually, its
nontrivial polynomial pieces are all of exact degree  k-1 .
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">E.g., the rightmost B-spline involves  5  knots, hence is of order  4 ,
i.e., a CUBIC B-spline.  Correspondingly, its second derivative is
piecewise linear.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">cl = [<span style="color:#B20000">'g'</span>,<span style="color:#B20000">'r'</span>,<span style="color:#B20000">'b'</span>,<span style="color:#B20000">'k'</span>,<span style="color:#B20000">'k'</span>];
v = 5.4; d1 = 2.5; d2 = 0; s1 = 1; s2 = .5;
t1 = [0 .8 2];
t2 = [3 4.4 5  6];
t3 = [7  7.9  9.2 10 11];
tt = [t1 t2 t3]; 
ext = tt([1 end])+[-.5 .5];
plot(ext([1 2]),[v v],cl(5))
hold on
plot(ext([1 2]),[d1 d1],cl(5))
plot(ext([1 2]),[d2 d2],cl(5))
tmp=NaN; 
ts = [tt;tt;repmat(NaN,size(tt))]; 
ty = repmat(.2*[-1;0;NaN],size(tt));
plot(ts(:),ty(:)+v,cl(5))
plot(ts(:),ty(:)+d1,cl(5))
plot(ts(:),ty(:)+d2,cl(5))
b1 = spmak(t1,1); 
p1 = [t1;0 1 0];
db1 = fnder(b1); 
p11 = fnplt(db1,<span style="color:#B20000">'j'</span>);
p12 = fnplt(fnder(db1));
lw = 2; 
plot(p1(1,:),p1(2,:)+v,cl(2),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s1*p11(2,:)+d1,cl(2),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*p12(2,:)+d2,cl(2),<span style="color:#B20000">'linew'</span>,lw)
axis([-1 12 -2 6.5])
b1 = spmak(t2,1); 
p1 = fnplt(b1);
db1 = fnder(b1); 
p11 = [t2;fnval(db1,t2)];
p12=fnplt(fnder(db1),<span style="color:#B20000">'j'</span>);
plot(p1(1,:),p1(2,:)+v,cl(3),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s1*p11(2,:)+d1,cl(3),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*p12(2,:)+d2,cl(3),<span style="color:#B20000">'linew'</span>,lw)
b1 = spmak(t3,1);
p1 = fnplt(b1); 
db1 = fnder(b1); 
p11 = fnplt(db1);
p12=[t3;fnval(fnder(db1),t3)];
plot(p1(1,:),p1(2,:)+v,cl(4),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s1*p11(2,:)+d1,cl(4),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*p12(2,:)+d2,cl(4),<span style="color:#B20000">'linew'</span>,lw)
tey = v+1.5;
text(t1(2)-.5,tey,<span style="color:#B20000">'linear'</span>,<span style="color:#B20000">'color'</span>,cl(2))
text(t2(2)-.8,tey,<span style="color:#B20000">'quadratic'</span>,<span style="color:#B20000">'color'</span>,cl(3))
text(t3(3)-.5,tey,<span style="color:#B20000">'cubic'</span>,<span style="color:#B20000">'color'</span>,cl(4))
text(-2,v,<span style="color:#B20000">'B'</span>), text(-2,d1,<span style="color:#B20000">'DB'</span>), text(-2,d2,<span style="color:#B20000">'D^2B'</span>)
axis off, hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_09_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">2. B_{j,k} is positive on the interval  (t_j .. t_{j+k})  and is zero off
that interval. It also vanishes at the endpoints of that interval (unless
the endpoint is a knot of multiplicity  k ; see the rightmost example on
the next slide).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;"><a name=""></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">3. Knot   MULTIPLICITY   determines the smoothness with which the two
adjacent polynomials join across that knot. In shorthand, the rule is:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">       knot multiplicity  +  number of smoothness conditions  =  order
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Above you see cubic B-splines and, below them, their first two
derivatives, with a certain knot of multiplicity 1, 2, 3, 4 (as indicated
by the length of the knot line).
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">E.g., since the order is  4 , a double knot means just 2 smoothness conditions,
i.e., just continuity  across that knot of the function and its first derivative.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">d2 = -1;
t1=[7  7.9  9.2 10 11]-7;
t2=[7  7.9 7.9  9 10]-2;
t3=[7  7.9 7.9 7.9 9]+2;
t4=[7  7.9 7.9 7.9 7.9]+5;
plot(1,1,<span style="color:#B20000">'or'</span>)
[m,tt]=knt2mlt([t1 t2 t3 t4]); 
ext = tt([1 end])+[-.5 .5];
plot(ext,[v v],cl(5)), hold on
plot(ext,[d1 d1],cl(5))
plot(ext,[d2 d2],cl(5))
ts = [tt;tt;repmat(NaN,size(tt))]; 
ty = .2*[-m-1;zeros(size(m));m];
plot(ts(:),ty(:)+v,cl(5))
plot(ts(:),ty(:)+d1,cl(5))
plot(ts(:),ty(:)+d2,cl(5))
b1 = spmak(t1,1);
p1=fnplt(b1);
db1=fnder(b1);
p11=fnplt(db1);
p12=[t1;fnval(fnder(db1),t1)];
plot(p1(1,:),p1(2,:)+v,cl(1),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s1*p11(2,:)+d1,cl(1),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*p12(2,:)+d2,cl(1),<span style="color:#B20000">'linew'</span>,lw)
text(-2,v,<span style="color:#B20000">'B'</span>), text(-2,d1,<span style="color:#B20000">'DB'</span>), text(-2,d2,<span style="color:#B20000">'D^2B'</span>)
b1 = spmak(t2,1);
p1=fnplt(b1);
db1=fnder(b1);
p11=fnplt(db1);
p12=fnplt(fnder(db1),<span style="color:#B20000">'j'</span>);
plot(p1(1,:),p1(2,:)+v,cl(2),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s1*p11(2,:)+d1,cl(2),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*s2*p12(2,:)+d2,cl(2),<span style="color:#B20000">'linew'</span>,lw)
b1 = spmak(t3,1);
p1=fnplt(b1);
db1=fnder(b1);
p11=fnplt(db1,<span style="color:#B20000">'j'</span>);
p12=fnplt(fnder(db1),<span style="color:#B20000">'j'</span>);
plot(p1(1,:),p1(2,:)+v,cl(3),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s1*s2*p11(2,:)+d1,cl(3),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*s2*p12(2,:)+d2,cl(3),<span style="color:#B20000">'linew'</span>,lw)
b1 = spmak(t4,1);
p1=fnplt(b1);
db1=fnder(b1);
p11=fnplt(db1);
p12=fnplt(fnder(db1));
plot(p1(1,:),p1(2,:)+v,cl(4),<span style="color:#B20000">'linew'</span>,lw)
plot(p11(1,:),s2*p11(2,:)+d1,cl(4),<span style="color:#B20000">'linew'</span>,lw)
plot(p12(1,:),s2*s2*p12(2,:)+d2,cl(4),<span style="color:#B20000">'linew'</span>,lw)
text(t2(2)-.5,tey,<span style="color:#B20000">'2-fold'</span>,<span style="color:#B20000">'color'</span>,cl(2))
text(t3(2)-.8,tey,<span style="color:#B20000">'3-fold'</span>,<span style="color:#B20000">'color'</span>,cl(3))
text(t4(3)-.8,tey,<span style="color:#B20000">'4-fold'</span>,<span style="color:#B20000">'color'</span>,cl(4))
axis off, hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_11_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">REFINEMENT and KNOT INSERTION<a name="REFINEMENT and KNOT INSERTION"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Any B-form can be REFINED, i.e., converted, by KNOT INSERTION, into the
B-form for the same function, but for a finer knot sequence. The finer
the knot sequence, the closer is the control polygon to the function
being represented.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">The refined control polygon shown above in red is obtained for the cubic
spline  SP  of a previous picture by the following commands:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">&gt;&gt; b = knt2brk(fnbrk(sp,'k')); spref = fnrfn( sp, (b(2:end)+b(1:end-1))/2);
 &gt;&gt; cr = fnbrk(spref,'c'); plot( aveknt( fnbrk(spref,'knots'), 4), cr,':r*')
</pre><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">sp = savesp;
fnplt(sp,2.5); 
hold on
c = fnbrk(sp,<span style="color:#B20000">'c'</span>);
plot(aveknt(fnbrk(sp,<span style="color:#B20000">'k'</span>),4),c,<span style="color:#B20000">':ok'</span>)
b=knt2brk(fnbrk(sp,<span style="color:#B20000">'k'</span>));
spref = fnrfn(sp,(b(2:end)+b(1:end-1))/2);
cr = fnbrk(spref,<span style="color:#B20000">'c'</span>);
plot(aveknt(fnbrk(spref,<span style="color:#B20000">'knots'</span>),4),cr,<span style="color:#B20000">':*r'</span>)
axis([-.72 7 -.5 3.5])
axis off
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_12_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">REFINEMENT and KNOT INSERTION (cont.)<a name="REFINEMENT and KNOT INSERTION (cont.)"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">In this second example, we start with the vertices of the standard
diamond as our control points, but run through the sequence twice:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">&gt;&gt; ozmz = [1 0 -1 0]; c = [ozmz ozmz 1; 0 ozmz ozmz]; circle = spmak(-4:8,c);
 &gt;&gt; fnplt(circle), hold on, plot(c(1,:),c(2,:),':ok'), hold off
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">However, when we plot the resulting spline, we get a curve that begins
and ends at the origin,  due to the fact that we chose to make the knot
sequence simple, hence our spline vanishes at the endpoints of its basic
interval, [-4 .. 8] . We really only want the part corresponding to the
interval [0 .. 4], as can be seen by plotting just that part, more
boldly:   &gt;&gt; fnplt(circle,[0 4],2)
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">ozmz = [1 0 -1 0]; 
c = [ozmz ozmz 1; 0 ozmz ozmz];
circle = spmak(-4:8,c);
fnplt(circle)
hold on
plot(c(1,:),c(2,:),<span style="color:#B20000">':ok'</span>)
axis(1.1*[-1 1 -1 1])
axis equal
axis off
fnplt(circle,[0 4],2)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_13_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">REFINEMENT and KNOT INSERTION (cont.)<a name="REFINEMENT and KNOT INSERTION (cont.)"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">To get just the circle, we restrict our spline to the interval [0 .. 4].
We do this by converting to ppform, restricting to [0 .. 4], then
converting to B-form.
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">&gt;&gt; circ = fn2fm( fnbrk( fn2fm(circle,'pp'), [0 4]), 'B-'); fnplt(circ,2.5)
 &gt;&gt; cc = fnbrk(circ,'c');  hold on, plot(cc(1,:),cc(2,:),':ok')
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">Refinement of the resulting knot sequence leads to a control polygon much
closer to the circle:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">&gt;&gt; ccc = fnbrk(fnrfn(circ,0.5:4),'c');   plot(ccc(1,:),ccc(2,:),'-r*'), hold off
</pre><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">circ = fn2fm(fnbrk(fn2fm(circle,<span style="color:#B20000">'pp'</span>),[0 4]),<span style="color:#B20000">'B-'</span>);
fnplt(circ,2.5)
hold on
axis(1.1*[-1 1 -1 1])
axis equal
axis off
cc = fnbrk(circ,<span style="color:#B20000">'c'</span>);
plot(cc(1,:),cc(2,:),<span style="color:#B20000">':ok'</span>)
ccc = fnbrk(fnrfn(circ,.5:4),<span style="color:#B20000">'c'</span>);
plot(ccc(1,:),ccc(2,:),<span style="color:#B20000">'-r*'</span>)
hold off</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_14_01.gif"><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="color:#990000; font-weight:bold; font-size:medium; page-break-before: auto;">MULTIVARIATE SPLINES<a name="MULTIVARIATE SPLINES"></a></p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">A spline in this toolbox can also be multivariate, namely the tensor
product of univariate splines. The B-form for such a function is only
slightly more complicated, with the knots now a cell array containing the
various univariate knot sequences, and the coefficient array suitably
multidimensional.
</p><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">For example, the above random spline surface results from the following:
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">&gt;&gt; fnplt( spmak( {augknt(0:4,4),augknt(0:4,3)}, rand(7,8) ) )
</pre><p xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">This spline is cubic in the first variable (there are 11 knots and 7
coefficients in that variable), but only piecewise constant in the second
variable ((2+5+2)-8 = 1).
</p><pre xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" style="position: relative; left:30px">fnplt( spmak( {augknt(0:4,4),augknt(0:4,3)}, rand(7,8) ) )</pre><img xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" src="spalldem_img_15_01.gif"><originalCode xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd" code="%% Intro to B-form&#xA;% A quick introduction to the B-form.&#xA;%&#xA;% Copyright 1987-2003 C. de Boor and The MathWorks, Inc.&#xA;% $Revision: 1.22 $  $Date: 2003/02/13 23:15:21 $&#xA;&#xA;%%&#xA;% In this toolbox, a pp function in B-form is often called a SPLINE.&#xA;% &#xA;% The  B-FORM  of a (univariate) pp is specified&#xA;% by its (nondecreasing)  k n o t  sequence  t  and&#xA;% by its B-spline  c o e f f i c i e n t  sequence  a .&#xA;% &#xA;% SPMAK(t,a) returns the corresponding B-form, for use in FN... commands.&#xA;% &#xA;% The resulting spline is of  o r d e r   k := LENGTH(t) - SIZE(a,2).&#xA;% This means that all its polynomial pieces have degree < k.&#xA;&#xA;t = [.1 .4 .5 .8 .9];&#xA;fnplt(spmak(t,1),2.5); &#xA;tmp = repmat(t,3,1); &#xA;ty = repmat(.1*[1;-1;NaN],1,5);&#xA;hold on&#xA;plot(tmp(:),ty(:))&#xA;text(.65,.5,'B( \cdot | .1, .4, .5, .8, .9)','Fontsize',10)&#xA;text(.02,1.,'s(x)  =  \Sigma_j  B( x | t_j , \ldots, t_{j+k} ) a(:,j)','Fontsize',18,'color','r')&#xA;axis([0 1 -.2 1.2])&#xA;hold off&#xA;&#xA;%%&#xA;% To say that  s  has knots  t  and coefficients  a  means that&#xA;% &#xA;%            n&#xA;%  s(x)  := sum  B_{j,k}(x) * a(:,j) , with B_(j,k) = B( . | t_j, ..., t_{j+k} )&#xA;%          j = 1&#xA;% &#xA;% the j-th B-SPLINE of ORDER  k  for the given KNOT SEQUENCE  t  ,&#xA;% &#xA;% i.e., the B-spline with knots  t_j, ..., t_{j+k} ; see the sample B-spline above.&#xA;&#xA;%% Local partition of unity and convex hull property&#xA;% The value of the spline  s(x) = sum_j B_{j,K}(x) a(:,j)  at any x in the&#xA;% knot interval  [t_i .. t_{i+1}]  is a CONVEX combination of the  k  &#xA;% coefficients a(:.i-k+1), ..., a(:,i)  since, on that interval, only the  k&#xA;% B-splines  B_{i-k+1,k}, ..., B_{i,k} are nonzero, and they are nonnegative&#xA;% there and sum to 1.&#xA;% &#xA;% This is often summarized by saying that the B-splines provide a&#xA;%   LOCAL  (nonnegative)  PARTITION  of  UNITY .&#xA;&#xA;k = 3; &#xA;n = 3; &#xA;t = [1 1.7 3.2 4.2 4.8 6]; &#xA;tt = (10:60)/10;&#xA;vals = fnval(spmak(t,eye(k)),tt); &#xA;plot(tt.',vals.');&#xA;hold on&#xA;ind = find(tt&gt;=t(3)&amp;tt<=t(4));&#xA;plot(tt(ind).',vals(:,ind).','linewi',3)&#xA;plot(t([3 4]),[1 1],'w','linewi',3)&#xA;axis([-.5 7 -.5 1.5])&#xA;ty = repmat(.1*[1;-1;NaN],1,6);&#xA;plot([0 0 -.2 0 0 -.2 0 0],[-.5 0 0 0 1 1 1 1.5],'k')&#xA;text(-.5,0,'0')&#xA;text(-.5,1,'1')&#xA;tmp = repmat(t,3,1);&#xA;plot(tmp(:),ty(:),'k');&#xA;yd = -.25; text(t(1),yd,'t_{i-2}'); &#xA;text(t(3),yd,'t_i');&#xA;text(t(4),yd,'t_{i+1}');&#xA;text(1.8,.5,'B_{i-2,3}'); &#xA;text(5,.45,'B_{i,3}');&#xA;axis off&#xA;hold off&#xA;&#xA;%% Convex hull property (cont.) and  control polygon&#xA;% When the coefficients are points in the plane and, correspondingly, the spline&#xA;% s(x) = sum_j B_{j,k}(x) a(:,j)  traces out a curve, this means that the curve piece&#xA;% { s(x) : t_i <= x <= t_{i+1} } lies in the convex hull (shown in yellow above) &#xA;% of the  k  points a(:,i-k+1), ... a(:,i).&#xA;% &#xA;% For a quadratic spline (i.e., k = 3), as shown here, it even means that&#xA;% the curve is tangent to the   CONTROL POLYGON   (shown in black dashes).&#xA;% This is the broken line that connects the coefficients (which are called&#xA;%  CONTROL POINTS  in this connection and shown here as open circles).&#xA;&#xA;t = 1:9; &#xA;c = [2 1.4;1 .5; 2 -.4; 5 1.4; 6 .5; 5 -.4].';&#xA;sp = spmak(t,c);&#xA;fill(c(1,3:5),c(2,3:5),'y','edgecolor','y'); &#xA;hold on&#xA;fnplt(sp,t([3 7]),1.5)&#xA;fnplt(sp,t([5 6]),3)&#xA;plot(c(1,:),c(2,:),':ok')&#xA;axis([.5 7 -.8 1.8])&#xA;axis off&#xA;text(2,-.55,'a(:,i-2)')&#xA;text(5,1.6,'a(:,i-1)')&#xA;text(6.1,.5,'a(:,i)')&#xA;hold off&#xA;&#xA;%% CONTROL POLYGON (cont.)&#xA;% We can think of the graph of the SCALAR-valued spline  s = sum_j B_{j,k}*a(j)&#xA;% as the curve  x |--&gt; (x,s(x)) .   Since   x  =  sum_j  B_{j,k}(x) t^*_j  &#xA;% for  x  in the interval  [t_k .. t_{n+1}] and with&#xA;%         t^*_i : =  (t_{i+1} + ... + t_{i+k-1})/(k-1),    i = 1:n,&#xA;% the knot averages obtainable by  AVEKNT(t,k) , the  CONTROL  POLYGON  for a&#xA;% scalar-valued spline is the broken line with vertices (t^*_i, a(i)), i=1:n.&#xA;% &#xA;% The example shows a  CUBIC  spline (k = 4), with 4-fold end knots, hence&#xA;% t^*_1 = t_1  and  t^*_n = t_{n+k} .&#xA;&#xA;t = [0 .2 .35 .47 .61 .84 1]*(2*pi); &#xA;s=t([1 3 4 5 7]);&#xA;knots = augknt(s,4);&#xA;sp = spapi(knots,t,sin(t)+1.8);&#xA;fnplt(sp,2); &#xA;hold on&#xA;c = fnbrk(sp,'c'); &#xA;ts = aveknt(knots,4);&#xA;plot(ts,c,':ok')&#xA;tt = [s;s;repmat(NaN,size(s))];&#xA;ty = repmat(.25*[-1;1;NaN], size(s));&#xA;plot(tt(:),ty(:),'r')&#xA;plot(ts(1,:),zeros(size(ts)),'*')&#xA;text(knots(5),-.5,'t_5')&#xA;text(ts(2),-.45,'t^*_2')&#xA;text(knots(1)-.28,-.5,'t_1=t_4')&#xA;text(knots(end)-.65,-.45,'t_{n+1}=t^*_n=t_{n+4}')&#xA;axis([-.72 7 -.5 3.5])&#xA;axis off&#xA;hold off&#xA;savesp = sp;&#xA;&#xA;%%&#xA;% The essential parts of the B-form are the knot sequence t and the B-spline&#xA;% coefficient sequence a . Other parts are the  NUMBER   n  of the B-splines&#xA;% or coefficients involved , the  ORDER  k  of its polynomial pieces, and the&#xA;% DIMENSION  d  of its coefficients. In particular,  size(a)  equals  [d,n] . &#xA;% &#xA;% There is one more part, namely the  BASIC INTERVAL , [ t(1) ..  t(end) ].&#xA;% It is used as the default interval when plotting the function.  Also,&#xA;% while the spline is taken to be continuous from the right, it is made&#xA;% continuous from the left at the right endpoint of the basic interval, as&#xA;% illustrated above, where values of the spline made by&#xA;%&#xA;%  &gt;&gt; sp = spmak(augknt(0:3,3),[-1,0,1,0,-1]); &#xA;%&#xA;% are plotted.&#xA;&#xA;b = 0:3; &#xA;sp = spmak(augknt(b,3),[-1,0,1,0,-1]);&#xA;x = linspace(-1,4,51);&#xA;plot(x,fnval(sp,x),'x')&#xA;hold on&#xA;axis([-2 5,-1.5,1])&#xA;tx = repmat(b,3,1); &#xA;ty = repmat(.15*[1;-1;NaN],1,length(b));&#xA;plot(tx(:),ty(:),'-r') &#xA;hold off&#xA;&#xA;%%&#xA;% FNBRK can be used to obtain any or all parts of a B-form. For example,&#xA;% here is the output provided by FNBRK(SP), with SP the B-form of the&#xA;% spline shown above:&#xA;% &#xA;%  knots(1:n+k)                    0     0     0     1     2     3     3     3&#xA;%  coefficients(d,n)              -1     0     1     0    -1 &#xA;%  number n of coefficients  5&#xA;%  order k                            3&#xA;%  dimension  d  of target     1&#xA;% &#xA;% However, there is usually NO NEED to know any of these parts. Rather, &#xA;% one uses commands like  SP = SPAPI(...)  or  SP = SPAPS(...)  to&#xA;% construct the B-form of a spline from some data, then uses commands like&#xA;% FNVAL(SP,...), FNPLT(SP,...), FNDER(SP)  etc., to make use of the spline&#xA;% constructed, without any need to look at its various parts.&#xA;% &#xA;% The next slides give more detailed information about the  B-splines, in&#xA;% particular about the important role played by knot  MULTIPLICITY .&#xA;&#xA;b = 0:3; &#xA;sp = spmak(augknt(b,3),[-1,0,1,0,-1]);&#xA;x = linspace(-1,4,51);&#xA;plot(x,fnval(sp,x),'x'), &#xA;hold on, &#xA;axis([-2 5,-1.5,1]),&#xA;tx = repmat(b,3,1); &#xA;ty = repmat(.15*[1;-1;NaN],1,length(b));&#xA;plot(tx(:),ty(:),'-r')&#xA;hold off&#xA;&#xA;%%&#xA;% Here, for  k=2,3,4, is a B-spline of order  k , and below it its first&#xA;% and second (piecewise) derivative, to illustrate the following facts (try&#xA;% out the BSPLIGUI if you want to experiment with examples of your own).&#xA;% &#xA;% 1. The B-spline  B_{j,k} = B( . | t_j, ..., t_{j+k})  is pp of order k&#xA;% with breaks at t_j, ..., t_{j+k}  (and nowhere else). Actually, its&#xA;% nontrivial polynomial pieces are all of exact degree  k-1 .&#xA;% &#xA;% E.g., the rightmost B-spline involves  5  knots, hence is of order  4 ,&#xA;% i.e., a CUBIC B-spline.  Correspondingly, its second derivative is&#xA;% piecewise linear.&#xA;&#xA;cl = ['g','r','b','k','k'];&#xA;v = 5.4; d1 = 2.5; d2 = 0; s1 = 1; s2 = .5;&#xA;t1 = [0 .8 2];&#xA;t2 = [3 4.4 5  6];&#xA;t3 = [7  7.9  9.2 10 11];&#xA;tt = [t1 t2 t3]; &#xA;ext = tt([1 end])+[-.5 .5];&#xA;plot(ext([1 2]),[v v],cl(5))&#xA;hold on&#xA;plot(ext([1 2]),[d1 d1],cl(5))&#xA;plot(ext([1 2]),[d2 d2],cl(5))&#xA;tmp=NaN; &#xA;ts = [tt;tt;repmat(NaN,size(tt))]; &#xA;ty = repmat(.2*[-1;0;NaN],size(tt));&#xA;plot(ts(:),ty(:)+v,cl(5))&#xA;plot(ts(:),ty(:)+d1,cl(5))&#xA;plot(ts(:),ty(:)+d2,cl(5))&#xA;b1 = spmak(t1,1); &#xA;p1 = [t1;0 1 0];&#xA;db1 = fnder(b1); &#xA;p11 = fnplt(db1,'j');&#xA;p12 = fnplt(fnder(db1));&#xA;lw = 2; &#xA;plot(p1(1,:),p1(2,:)+v,cl(2),'linew',lw)&#xA;plot(p11(1,:),s1*p11(2,:)+d1,cl(2),'linew',lw)&#xA;plot(p12(1,:),s2*p12(2,:)+d2,cl(2),'linew',lw)&#xA;axis([-1 12 -2 6.5])&#xA;b1 = spmak(t2,1); &#xA;p1 = fnplt(b1);&#xA;db1 = fnder(b1); &#xA;p11 = [t2;fnval(db1,t2)];&#xA;p12=fnplt(fnder(db1),'j');&#xA;plot(p1(1,:),p1(2,:)+v,cl(3),'linew',lw)&#xA;plot(p11(1,:),s1*p11(2,:)+d1,cl(3),'linew',lw)&#xA;plot(p12(1,:),s2*p12(2,:)+d2,cl(3),'linew',lw)&#xA;b1 = spmak(t3,1);&#xA;p1 = fnplt(b1); &#xA;db1 = fnder(b1); &#xA;p11 = fnplt(db1);&#xA;p12=[t3;fnval(fnder(db1),t3)];&#xA;plot(p1(1,:),p1(2,:)+v,cl(4),'linew',lw)&#xA;plot(p11(1,:),s1*p11(2,:)+d1,cl(4),'linew',lw)&#xA;plot(p12(1,:),s2*p12(2,:)+d2,cl(4),'linew',lw)&#xA;tey = v+1.5;&#xA;text(t1(2)-.5,tey,'linear','color',cl(2))&#xA;text(t2(2)-.8,tey,'quadratic','color',cl(3))&#xA;text(t3(3)-.5,tey,'cubic','color',cl(4))&#xA;text(-2,v,'B'), text(-2,d1,'DB'), text(-2,d2,'D^2B')&#xA;axis off, hold off&#xA;&#xA;%%&#xA;% 2. B_{j,k} is positive on the interval  (t_j .. t_{j+k})  and is zero off&#xA;% that interval. It also vanishes at the endpoints of that interval (unless&#xA;% the endpoint is a knot of multiplicity  k ; see the rightmost example on&#xA;% the next slide).&#xA;&#xA;%%&#xA;% 3. Knot   MULTIPLICITY   determines the smoothness with which the two&#xA;% adjacent polynomials join across that knot. In shorthand, the rule is:&#xA;% &#xA;%         knot multiplicity  +  number of smoothness conditions  =  order&#xA;% &#xA;% Above you see cubic B-splines and, below them, their first two&#xA;% derivatives, with a certain knot of multiplicity 1, 2, 3, 4 (as indicated&#xA;% by the length of the knot line).&#xA;% &#xA;% E.g., since the order is  4 , a double knot means just 2 smoothness conditions,&#xA;% i.e., just continuity  across that knot of the function and its first derivative.&#xA;&#xA;d2 = -1;&#xA;t1=[7  7.9  9.2 10 11]-7;&#xA;t2=[7  7.9 7.9  9 10]-2;&#xA;t3=[7  7.9 7.9 7.9 9]+2;&#xA;t4=[7  7.9 7.9 7.9 7.9]+5;&#xA;plot(1,1,'or')&#xA;[m,tt]=knt2mlt([t1 t2 t3 t4]); &#xA;ext = tt([1 end])+[-.5 .5];&#xA;plot(ext,[v v],cl(5)), hold on&#xA;plot(ext,[d1 d1],cl(5))&#xA;plot(ext,[d2 d2],cl(5))&#xA;ts = [tt;tt;repmat(NaN,size(tt))]; &#xA;ty = .2*[-m-1;zeros(size(m));m];&#xA;plot(ts(:),ty(:)+v,cl(5))&#xA;plot(ts(:),ty(:)+d1,cl(5))&#xA;plot(ts(:),ty(:)+d2,cl(5))&#xA;b1 = spmak(t1,1);&#xA;p1=fnplt(b1);&#xA;db1=fnder(b1);&#xA;p11=fnplt(db1);&#xA;p12=[t1;fnval(fnder(db1),t1)];&#xA;plot(p1(1,:),p1(2,:)+v,cl(1),'linew',lw)&#xA;plot(p11(1,:),s1*p11(2,:)+d1,cl(1),'linew',lw)&#xA;plot(p12(1,:),s2*p12(2,:)+d2,cl(1),'linew',lw)&#xA;text(-2,v,'B'), text(-2,d1,'DB'), text(-2,d2,'D^2B')&#xA;b1 = spmak(t2,1);&#xA;p1=fnplt(b1);&#xA;db1=fnder(b1);&#xA;p11=fnplt(db1);&#xA;p12=fnplt(fnder(db1),'j');&#xA;plot(p1(1,:),p1(2,:)+v,cl(2),'linew',lw)&#xA;plot(p11(1,:),s1*p11(2,:)+d1,cl(2),'linew',lw)&#xA;plot(p12(1,:),s2*s2*p12(2,:)+d2,cl(2),'linew',lw)&#xA;b1 = spmak(t3,1);&#xA;p1=fnplt(b1);&#xA;db1=fnder(b1);&#xA;p11=fnplt(db1,'j');&#xA;p12=fnplt(fnder(db1),'j');&#xA;plot(p1(1,:),p1(2,:)+v,cl(3),'linew',lw)&#xA;plot(p11(1,:),s1*s2*p11(2,:)+d1,cl(3),'linew',lw)&#xA;plot(p12(1,:),s2*s2*p12(2,:)+d2,cl(3),'linew',lw)&#xA;b1 = spmak(t4,1);&#xA;p1=fnplt(b1);&#xA;db1=fnder(b1);&#xA;p11=fnplt(db1);&#xA;p12=fnplt(fnder(db1));&#xA;plot(p1(1,:),p1(2,:)+v,cl(4),'linew',lw)&#xA;plot(p11(1,:),s2*p11(2,:)+d1,cl(4),'linew',lw)&#xA;plot(p12(1,:),s2*s2*p12(2,:)+d2,cl(4),'linew',lw)&#xA;text(t2(2)-.5,tey,'2-fold','color',cl(2))&#xA;text(t3(2)-.8,tey,'3-fold','color',cl(3))&#xA;text(t4(3)-.8,tey,'4-fold','color',cl(4))&#xA;axis off, hold off&#xA;&#xA;%% REFINEMENT and KNOT INSERTION&#xA;% Any B-form can be REFINED, i.e., converted, by KNOT INSERTION, into the&#xA;% B-form for the same function, but for a finer knot sequence. The finer&#xA;% the knot sequence, the closer is the control polygon to the function&#xA;% being represented.&#xA;% &#xA;% The refined control polygon shown above in red is obtained for the cubic&#xA;% spline  SP  of a previous picture by the following commands:&#xA;% &#xA;%  &gt;&gt; b = knt2brk(fnbrk(sp,'k')); spref = fnrfn( sp, (b(2:end)+b(1:end-1))/2);&#xA;%  &gt;&gt; cr = fnbrk(spref,'c'); plot( aveknt( fnbrk(spref,'knots'), 4), cr,':r*')&#xA;&#xA;sp = savesp;&#xA;fnplt(sp,2.5); &#xA;hold on&#xA;c = fnbrk(sp,'c');&#xA;plot(aveknt(fnbrk(sp,'k'),4),c,':ok')&#xA;b=knt2brk(fnbrk(sp,'k'));&#xA;spref = fnrfn(sp,(b(2:end)+b(1:end-1))/2);&#xA;cr = fnbrk(spref,'c');&#xA;plot(aveknt(fnbrk(spref,'knots'),4),cr,':*r')&#xA;axis([-.72 7 -.5 3.5])&#xA;axis off&#xA;hold off&#xA;&#xA;%% REFINEMENT and KNOT INSERTION (cont.)&#xA;% In this second example, we start with the vertices of the standard&#xA;% diamond as our control points, but run through the sequence twice:&#xA;%&#xA;%  &gt;&gt; ozmz = [1 0 -1 0]; c = [ozmz ozmz 1; 0 ozmz ozmz]; circle = spmak(-4:8,c);&#xA;%  &gt;&gt; fnplt(circle), hold on, plot(c(1,:),c(2,:),':ok'), hold off&#xA;%&#xA;% However, when we plot the resulting spline, we get a curve that begins&#xA;% and ends at the origin,  due to the fact that we chose to make the knot&#xA;% sequence simple, hence our spline vanishes at the endpoints of its basic&#xA;% interval, [-4 .. 8] . We really only want the part corresponding to the&#xA;% interval [0 .. 4], as can be seen by plotting just that part, more&#xA;% boldly:   &gt;&gt; fnplt(circle,[0 4],2)&#xA;&#xA;ozmz = [1 0 -1 0]; &#xA;c = [ozmz ozmz 1; 0 ozmz ozmz];&#xA;circle = spmak(-4:8,c);&#xA;fnplt(circle)&#xA;hold on&#xA;plot(c(1,:),c(2,:),':ok')&#xA;axis(1.1*[-1 1 -1 1])&#xA;axis equal&#xA;axis off&#xA;fnplt(circle,[0 4],2)&#xA;hold off&#xA;&#xA;%% REFINEMENT and KNOT INSERTION (cont.)&#xA;% To get just the circle, we restrict our spline to the interval [0 .. 4].&#xA;% We do this by converting to ppform, restricting to [0 .. 4], then&#xA;% converting to B-form.&#xA;%&#xA;%  &gt;&gt; circ = fn2fm( fnbrk( fn2fm(circle,'pp'), [0 4]), 'B-'); fnplt(circ,2.5)&#xA;%  &gt;&gt; cc = fnbrk(circ,'c');  hold on, plot(cc(1,:),cc(2,:),':ok')&#xA;% &#xA;% Refinement of the resulting knot sequence leads to a control polygon much&#xA;% closer to the circle:&#xA;%&#xA;%  &gt;&gt; ccc = fnbrk(fnrfn(circ,0.5:4),'c');   plot(ccc(1,:),ccc(2,:),'-r*'), hold off&#xA;&#xA;circ = fn2fm(fnbrk(fn2fm(circle,'pp'),[0 4]),'B-');&#xA;fnplt(circ,2.5)&#xA;hold on&#xA;axis(1.1*[-1 1 -1 1])&#xA;axis equal&#xA;axis off&#xA;cc = fnbrk(circ,'c');&#xA;plot(cc(1,:),cc(2,:),':ok')&#xA;ccc = fnbrk(fnrfn(circ,.5:4),'c');&#xA;plot(ccc(1,:),ccc(2,:),'-r*')&#xA;hold off&#xA;&#xA;%% MULTIVARIATE SPLINES&#xA;% A spline in this toolbox can also be multivariate, namely the tensor&#xA;% product of univariate splines. The B-form for such a function is only&#xA;% slightly more complicated, with the knots now a cell array containing the&#xA;% various univariate knot sequences, and the coefficient array suitably&#xA;% multidimensional.&#xA;% &#xA;% For example, the above random spline surface results from the following:&#xA;%&#xA;%  &gt;&gt; fnplt( spmak( {augknt(0:4,4),augknt(0:4,3)}, rand(7,8) ) )&#xA;%&#xA;% This spline is cubic in the first variable (there are 11 knots and 7&#xA;% coefficients in that variable), but only piecewise constant in the second&#xA;% variable ((2+5+2)-8 = 1).&#xA;&#xA;fnplt( spmak( {augknt(0:4,4),augknt(0:4,3)}, rand(7,8) ) )&#xA;&#xA;&#xA;"></originalCode>